---
import Layout from "../../layouts/Layout.astro";
import { app } from "../../firebase/server";
import { marked } from 'marked';
import { getFirestore } from "firebase-admin/firestore";

interface Page {
  title: string;
  content: string;
}

const { id } = Astro.params;

if (!id) {
  console.log(`No id provided`);
  return Astro.redirect("/404");
}

const db = getFirestore(app);
const AcademyRef = db.collection("academy");
const AcademyPageSnapshot = await AcademyRef.where("slug", "==", id).get();


if (AcademyPageSnapshot.empty) {
  return Astro.redirect("/404");
}

const [pageRaw] = AcademyPageSnapshot.docs;
const page = pageRaw.data() as Page;
const mdContent = marked(page.content);

---

<Layout title={page.title}>
  <h1>{page.title}</h1>

  <article set:html={mdContent}/>
</Layout>
